# Запускаем VPN по протоколу AmneziaWG на роутере Keenetic

Исходим из того, что у вас уже есть файл с конфигурацией AmneziaWG, которую вы хотите запустить на вашем Кинетике.

KeeneticOS поддерживает протокол AmneziaWG начиная с версии 4.2. В частности KeeneticOS 4.2.1 позволяет импортировать конфиг AmneziaWG как обычный WireGuard и далее донастроить параметры asc (`Jc`, `Jmin`, `Jmax`, `S1`, `S2`, `H1`, `H2`, `H3`, `H4`) через командную строку (CL) KeeneticOS.

## Обновляем роутер до актуальной версии KeeneticOS 4.2 и старше.

## Проверяем, что в KeeneticOS у вас установлен компонент WireGuard: 
Параметры системы — Изменить набор компонентов — WireGuard VPN — Установлен.

## Импортируем ваш файл с конфигурацией AmneziaWG (*.conf) в KeeneticOS как обычный конфиг WireGuard через: 
Другие подключения — WireGuard — Загрузить из файла — ваш файл *.conf с AmneziaWG.

## Нажимаем в списке WireGuard на строку с только что созданным подключением и ставим галочку: Использовать для выхода в интернет. Сохраняем.

## Запоминаем имя только что созданного подключения в списке WireGuard. 
Это имя вашего *.conf файла или имя, которым вы назвали это подключение после импорта.

## Открываем командную строку (CL) в KeeneticOS: 
значок шестеренки в верхнем правом углу — Командная строка.

## В открывшейся командной строке вводим команду “show interface” (без кавычек) и нажимаем: Отправить запрос.

## Находим имя созданного вами интерфейса (подключения). 
В параметре `description` должно быть имя вашего соединения из пункта 4. Рядом с description будет параметр `interface-name`.

## Нас интересует `interface-name` вашего подключения.

## Открываем файл с конфигурацией AmneziaWG, чтобы видеть параметры `Jc`, `Jmin`, `Jmax`, `S1`, `S2`, `H1`, `H2`, `H3`, `H4`.
Теперь мы знаем имя интерфейса и значения параметров asc из файла конфигурации AmneziaWG (*.conf). Теперь необходимо заменить все значения шаблона в скобках, на ваше значения, а фигурные скобки удалить:

`interface {interface-name} wireguard asc {jc} {jmin} {jmax} {s1} {s2} {h1} {h2} {h3} {h4}`

## Получится строка вида:

`interface Wireguard1 wireguard asc 3 40 80 35 90 129283290 8726729867 194782156 543347908`

## Полученную строку с вашими параметрами вставляем в командную строку (CL) в KeeneticOS и нажимаем: Отправить запрос.

Теперь у вас VPN-соединение по протоколу AmneziaWG. Остается только настроить политики для устройств в разделе: Приоритеты подключений.

## Официальная документация AmneziaWG для KeeneticOS:
https://docs.amnezia.org/documentation/instructions/keenetic-os-awg/
